"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("vue"),f=require("@reevit/core");function ie(t){const n=t.toLowerCase();return n.includes("paystack")?"paystack":n.includes("hubtel")?"hubtel":n.includes("flutterwave")?"flutterwave":n.includes("stripe")?"stripe":n.includes("monnify")?"monnify":n.includes("mpesa")||n.includes("m-pesa")?"mpesa":"paystack"}function le(t){const n=t.toLowerCase().trim();return n==="card"?"card":n==="mobile_money"||n==="momo"||n==="mobilemoney"?"mobile_money":n==="bank"||n==="bank_transfer"||n==="transfer"?"bank_transfer":null}function ce(t){if(!(!t||t.length===0))return t.map(n=>{const o=n.methods.map(c=>le(c)).filter(Boolean);return{provider:n.provider,name:n.name,methods:o,countries:n.countries}}).filter(n=>n.methods.length>0)}function de(t,n){return{id:t.id,clientSecret:t.client_secret,pspPublicKey:t.psp_public_key,pspCredentials:t.psp_credentials,amount:t.amount,currency:t.currency,status:t.status,recommendedPsp:ie(t.provider),availableMethods:n.paymentMethods||["card","mobile_money"],reference:t.reference||n.reference,connectionId:t.connection_id,provider:t.provider,feeAmount:t.fee_amount,feeCurrency:t.fee_currency,netAmount:t.net_amount,metadata:n.metadata,availableProviders:ce(t.available_psps),branding:t.branding}}function Y(t){const{config:n,onSuccess:o,onError:c,onClose:s,onStateChange:u,apiBaseUrl:m}=t,a=e.ref(f.createInitialState());if(n.initialPaymentIntent){const v=n.initialPaymentIntent;a.value={...a.value,status:"ready",paymentIntent:v,selectedMethod:v.availableMethods?.length===1?v.availableMethods[0]:null}}const p=new f.ReevitAPIClient({publicKey:n.publicKey,baseUrl:m}),r=v=>{a.value=f.reevitReducer(a.value,v)};e.watch(()=>a.value.status,v=>{u?.(v)});const l=async(v,b)=>{r({type:"INIT_START"});try{const k=n.reference||f.generateReference(),C=f.detectCountryFromCurrency(n.currency),S=v||n.paymentMethods?.[0]||"card",{data:g,error:x}=await p.createPaymentIntent({...n,reference:k},S,C,{preferredProviders:b?.preferredProvider?[b.preferredProvider]:void 0,allowedProviders:b?.allowedProviders});if(x){r({type:"INIT_ERROR",payload:x}),c?.(x);return}if(!g){const R={code:"INIT_FAILED",message:"No data received from API",recoverable:!0};r({type:"INIT_ERROR",payload:R}),c?.(R);return}const M=de(g,{...n,reference:k});r({type:"INIT_SUCCESS",payload:M})}catch(k){const C={code:"INIT_FAILED",message:k instanceof Error?k.message:"Failed to initialize checkout",recoverable:!0,originalError:k};r({type:"INIT_ERROR",payload:C}),c?.(C)}},y=v=>{r({type:"SELECT_METHOD",payload:v})},N=async v=>{if(!(!a.value.paymentIntent||!a.value.selectedMethod)){r({type:"PROCESS_START"});try{let b;if(a.value.paymentIntent.clientSecret){const{data:C,error:S}=await p.confirmPaymentIntent(a.value.paymentIntent.id,a.value.paymentIntent.clientSecret);if(S){r({type:"PROCESS_ERROR",payload:S}),c?.(S);return}b=C}else{const{data:C,error:S}=await p.confirmPayment(a.value.paymentIntent.id);if(S){r({type:"PROCESS_ERROR",payload:S}),c?.(S);return}b=C}const k={paymentId:a.value.paymentIntent.id,reference:v.reference||a.value.paymentIntent.reference||a.value.paymentIntent.metadata?.reference||"",amount:a.value.paymentIntent.amount,currency:a.value.paymentIntent.currency,paymentMethod:a.value.selectedMethod,psp:a.value.paymentIntent.recommendedPsp,pspReference:v.pspReference||b?.provider_ref_id||"",status:"success",metadata:v};r({type:"PROCESS_SUCCESS",payload:k}),o?.(k)}catch(b){const k={code:"PAYMENT_FAILED",message:b instanceof Error?b.message:"Payment failed",recoverable:!0,originalError:b};r({type:"PROCESS_ERROR",payload:k}),c?.(k)}}},$=async v=>{await N(v)},j=v=>{r({type:"PROCESS_ERROR",payload:v}),c?.(v)},L=()=>{r({type:"RESET"})},I=async()=>{if(a.value.paymentIntent&&a.value.status!=="success")try{await p.cancelPaymentIntent(a.value.paymentIntent.id)}catch{}r({type:"CLOSE"}),s?.()},P=e.computed(()=>a.value.status),T=e.computed(()=>a.value.paymentIntent),D=e.computed(()=>a.value.selectedMethod),O=e.computed(()=>a.value.error),B=e.computed(()=>a.value.result),V=e.computed(()=>a.value.status==="loading"||a.value.status==="processing"),w=e.computed(()=>a.value.status==="ready"||a.value.status==="method_selected"||a.value.status==="processing"),F=e.computed(()=>a.value.status==="success"),A=e.computed(()=>a.value.error?.recoverable??!1);return{status:e.readonly(P),paymentIntent:e.readonly(T),selectedMethod:e.readonly(D),error:e.readonly(O),result:e.readonly(B),initialize:l,selectMethod:y,processPayment:N,handlePspSuccess:$,handlePspError:j,reset:L,close:I,isLoading:e.readonly(V),isReady:e.readonly(w),isComplete:e.readonly(F),canRetry:e.readonly(A)}}const ue={key:0,class:"reevit-method-selector__label"},me=["onClick"],pe={class:"reevit-method-option__icon-wrapper"},ve={class:"reevit-method-option__icon"},ye={class:"reevit-method-option__content"},he={class:"reevit-method-option__label"},be={key:0,class:"reevit-method-option__description"},fe={key:0,class:"reevit-method-option__check"},ke={key:1,class:"reevit-method-option__chevron"},K=e.defineComponent({__name:"PaymentMethodSelector",props:{methods:{},selected:{},provider:{},layout:{},showLabel:{type:Boolean}},emits:["select"],setup(t,{emit:n}){const o=t,{showLabel:c=!0}=o,s=n,u=e.computed(()=>(o.layout||"list")==="grid"),m=e.computed(()=>[{id:"card",name:"Card",icon:"ðŸ’³",description:"Pay with Visa, Mastercard, or other cards"},{id:"mobile_money",name:"Mobile Money",icon:"ðŸ“±",description:"MTN, Vodafone Cash, AirtelTigo Money"},{id:"bank_transfer",name:"Bank Transfer",icon:"ðŸ¦",description:"Pay directly from your bank account"}].filter(a=>o.methods.includes(a.id)));return(a,p)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["reevit-method-selector",{"reevit-method-selector--grid":u.value}])},[e.unref(c)?(e.openBlock(),e.createElementBlock("div",ue,"Select payment method")):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(["reevit-method-selector__options",u.value?"reevit-method-selector__options--grid":"reevit-method-selector__options--list"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.value,(r,l)=>(e.openBlock(),e.createElementBlock("button",{key:r.id,type:"button",class:e.normalizeClass(["reevit-method-option",[u.value?"reevit-method-option--grid":"reevit-method-option--list",{"reevit-method-option--selected":t.selected===r.id}]]),style:e.normalizeStyle({animationDelay:`${l*.05}s`}),onClick:y=>s("select",r.id)},[e.createElementVNode("span",pe,[e.createElementVNode("span",ve,e.toDisplayString(r.icon),1)]),e.createElementVNode("div",ye,[e.createElementVNode("span",he,e.toDisplayString(r.name),1),u.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",be,e.toDisplayString(r.description),1))]),u.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t.selected===r.id?(e.openBlock(),e.createElementBlock("span",fe,[...p[0]||(p[0]=[e.createElementVNode("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},[e.createElementVNode("polyline",{points:"20 6 9 17 4 12"})],-1)])])):(e.openBlock(),e.createElementBlock("span",ke,[...p[1]||(p[1]=[e.createElementVNode("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"},[e.createElementVNode("polyline",{points:"9 18 15 12 9 6"})],-1)])]))],64))],14,me))),128))],2)],2))}}),Ee={class:"reevit-psp-selector"},_e={class:"reevit-psp-selector__options"},we=["disabled","aria-expanded","onClick"],Pe={class:"reevit-psp-option__logo","aria-hidden":"true"},ge=["src"],Ce={key:1,class:"reevit-psp-option__logo-fallback"},Se={class:"reevit-psp-option__content"},Me={class:"reevit-psp-option__name"},Ne={class:"reevit-psp-option__methods"},Ie={key:0,class:"reevit-psp-accordion__content reevit-animate-fade-in"},Be={class:"reevit-psp-methods"},G=e.defineComponent({__name:"ProviderSelector",props:{providers:{},selectedProvider:{},disabled:{type:Boolean},theme:{},selectedMethod:{}},emits:["select","methodSelect"],setup(t,{emit:n}){const o=n,c={paystack:"https://reevit.io/images/providers/paystack.png",stripe:"https://reevit.io/images/providers/stripe.png",flutterwave:"https://reevit.io/images/providers/flutterwave.png",hubtel:"https://reevit.io/images/providers/hubtel.png",monnify:"https://reevit.io/images/providers/monnify.png",mpesa:"https://reevit.io/images/providers/mpesa.png"},s={card:"Card",mobile_money:"Mobile Money",bank_transfer:"Bank Transfer"},u=a=>a.length?a.map(p=>s[p]).join(", "):"Payment methods",m=(a,p)=>a.toLowerCase().includes("hubtel")?p.filter(r=>r==="card"||r==="mobile_money"):p;return(a,p)=>(e.openBlock(),e.createElementBlock("div",Ee,[p[1]||(p[1]=e.createElementVNode("div",{class:"reevit-psp-selector__label"},"Select payment provider",-1)),e.createElementVNode("div",_e,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.providers,r=>(e.openBlock(),e.createElementBlock("div",{key:r.provider,class:"reevit-psp-accordion"},[e.createElementVNode("button",{type:"button",class:e.normalizeClass(e.unref(f.cn)("reevit-psp-option",t.selectedProvider===r.provider&&"reevit-psp-option--selected",t.disabled&&"reevit-psp-option--disabled")),disabled:t.disabled,"aria-expanded":t.selectedProvider===r.provider,onClick:l=>o("select",r.provider)},[e.createElementVNode("span",Pe,[c[r.provider]?(e.openBlock(),e.createElementBlock("img",{key:0,src:c[r.provider],alt:"",class:"reevit-psp-option__logo-img",loading:"lazy"},null,8,ge)):(e.openBlock(),e.createElementBlock("span",Ce,e.toDisplayString(r.name.slice(0,1).toUpperCase()),1))]),e.createElementVNode("div",Se,[e.createElementVNode("span",Me,e.toDisplayString(r.name),1),e.createElementVNode("span",Ne,e.toDisplayString(u(m(r.provider,r.methods))),1)])],10,we),t.selectedProvider===r.provider?(e.openBlock(),e.createElementBlock("div",Ie,[e.createElementVNode("div",Be,[e.createVNode(K,{methods:m(r.provider,r.methods),selected:t.selectedMethod||null,provider:r.provider,"show-label":!1,layout:"list",onSelect:p[0]||(p[0]=l=>o("methodSelect",l))},null,8,["methods","selected","provider"])]),e.renderSlot(a.$slots,"method-content")])):e.createCommentVNode("",!0)]))),128))])]))}}),Ve={class:"reevit-form-group"},Re=["disabled"],$e={class:"reevit-network-selector"},xe={class:"reevit-networks-grid"},Te=["onClick","disabled"],Oe={key:0,class:"reevit-error-message"},Le={class:"reevit-momo-form__actions"},De=["disabled"],Fe=["disabled"],Ue={key:0,class:"reevit-spinner"},ze={key:1},H=e.defineComponent({__name:"MobileMoneyForm",props:{initialPhone:{},loading:{type:Boolean},hideCancel:{type:Boolean}},emits:["submit","cancel"],setup(t,{emit:n}){const o=t,c=n,s=e.ref(o.initialPhone||""),u=e.ref(null),m=e.ref(null);e.watch(s,r=>{const l=f.detectNetwork(r);l&&(u.value=l),m.value&&(m.value=null)});const a=()=>{if(!f.validatePhone(s.value)){m.value="Please enter a valid phone number";return}if(!u.value){m.value="Please select your mobile network";return}c("submit",{phone:s.value,network:u.value})},p=[{id:"mtn",name:"MTN",color:"#FFCC00"},{id:"vodafone",name:"Vodafone",color:"#E60000"},{id:"airteltigo",name:"AirtelTigo",color:"#005596"}];return(r,l)=>(e.openBlock(),e.createElementBlock("form",{class:"reevit-momo-form",onSubmit:e.withModifiers(a,["prevent"])},[e.createElementVNode("div",Ve,[l[2]||(l[2]=e.createElementVNode("label",{class:"reevit-label",for:"reevit-phone"},"Phone Number",-1)),e.withDirectives(e.createElementVNode("input",{id:"reevit-phone","onUpdate:modelValue":l[0]||(l[0]=y=>s.value=y),type:"tel",class:e.normalizeClass(["reevit-input",{"reevit-input--error":m.value&&!e.unref(f.validatePhone)(s.value)}]),placeholder:"e.g. 024 123 4567",disabled:t.loading,autocomplete:"tel"},null,10,Re),[[e.vModelText,s.value]])]),e.createElementVNode("div",$e,[l[3]||(l[3]=e.createElementVNode("label",{class:"reevit-label"},"Select Network",-1)),e.createElementVNode("div",xe,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(p,y=>e.createElementVNode("button",{key:y.id,type:"button",class:e.normalizeClass(e.unref(f.cn)("reevit-network-btn",u.value===y.id&&"reevit-network-btn--selected")),onClick:N=>u.value=y.id,disabled:t.loading},[e.createElementVNode("div",{class:"reevit-network-dot",style:e.normalizeStyle({backgroundColor:y.color})},null,4),e.createTextVNode(" "+e.toDisplayString(y.name),1)],10,Te)),64))])]),m.value?(e.openBlock(),e.createElementBlock("p",Oe,e.toDisplayString(m.value),1)):e.createCommentVNode("",!0),e.createElementVNode("div",Le,[t.hideCancel?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("button",{key:0,type:"button",class:"reevit-btn reevit-btn--secondary",onClick:l[1]||(l[1]=y=>c("cancel")),disabled:t.loading}," Back ",8,De)),e.createElementVNode("button",{type:"submit",class:"reevit-btn reevit-btn--primary",disabled:t.loading||!s.value},[t.loading?(e.openBlock(),e.createElementBlock("span",Ue)):(e.openBlock(),e.createElementBlock("span",ze,"Continue"))],8,Fe)]),l[4]||(l[4]=e.createElementVNode("p",{class:"reevit-secure-text"}," ðŸ”’ Secure mobile money payment via Reevit ",-1))],32))}});class je{constructor(n){this.baseUrl="https://unified-pay.hubtel.com",this.messageHandler=null,this.stylesInjected=!1,n&&(this.baseUrl=n)}redirect({purchaseInfo:n,config:o}){const c=this.createCheckoutUrl(n,o),s=window.open(c);if(!s||s.closed||typeof s.closed>"u")throw new Error("Popup was blocked by the browser. Please allow popups for this site.")}initIframe({purchaseInfo:n,callBacks:o,config:c,iframeStyle:s}){var u,m,a;this.registerEvents(o);const p=document.getElementById("hubtel-checkout-iframe");if(!p)throw new Error('Container element with id "hubtel-checkout-iframe" not found in the DOM.');p.innerHTML="";const r=document.createElement("div");r.textContent="Loading...",p.appendChild(r);const l=document.createElement("iframe");l.setAttribute("id","hubtel-iframe-element"),l.src=this.createCheckoutUrl(n,c),l.style.display="none",l.style.width=(u=s?.width)!==null&&u!==void 0?u:"100%",l.style.height=(m=s?.height)!==null&&m!==void 0?m:"100%",l.style.minHeight=s?.minHeight||"400px",l.style.border=(a=s?.border)!==null&&a!==void 0?a:"none",l.onload=()=>{var y;p.removeChild(r),l.style.display="block",(y=o.onLoad)===null||y===void 0||y.call(o)},p.appendChild(l)}openModal({purchaseInfo:n,callBacks:o,config:c}){this.injectStyles(),this.createIframe(),this.handleBackButton(),this.registerEvents(o),this.renderWebpageInPopup(this.createCheckoutUrl(n,c),o.onClose,o.onLoad)}createCheckoutUrl(n,o){const c=Object.assign(Object.assign({},n),o),s=Object.keys(c).reduce((r,l)=>(c[l]!==null&&c[l]!==void 0&&(r[l]=c[l]),r),{}),u=Object.keys(s).map(r=>`${r}=${encodeURIComponent(s[r])}`).join("&"),m=this.encodeBase64(u),a=encodeURIComponent(m);return`${s?.branding==="disabled"?`${this.baseUrl}/pay/direct`:`${this.baseUrl}/pay`}?p=${a}`}encodeBase64(n){return btoa(unescape(encodeURIComponent(n)))}handleBackButton(){window.addEventListener("popstate",()=>{this.closePopUp()})}createIframe(){const n=document.createElement("div");n.setAttribute("id","backdrop"),n.classList.add("backdrop");const o=document.createElement("span");o.classList.add("checkout-loader"),n.appendChild(o),document.body.appendChild(n)}registerEvents(n){this.messageHandler&&window.removeEventListener("message",this.messageHandler,!1);const o=c=>{var s,u,m,a,p,r;if(c.origin!==this.baseUrl)return;const{data:l}=c;if(l.success===!0)(s=n.onPaymentSuccess)===null||s===void 0||s.call(n,l);else if(l.success===!1)(u=n.onPaymentFailure)===null||u===void 0||u.call(n,l);else if(l.initialized)(m=n.init)===null||m===void 0||m.call(n,l),(a=n.onInit)===null||a===void 0||a.call(n,l);else if(l.feesChanged)(p=n.onFeesChanged)===null||p===void 0||p.call(n,l.fees);else if(l.resize){const y=document.getElementById("hubtel-iframe-element");y&&(y.style.height=l.height+"px"),(r=n?.onResize)===null||r===void 0||r.call(n,l)}};this.messageHandler=o,window.addEventListener("message",o,!1)}destroy(){this.messageHandler&&(window.removeEventListener("message",this.messageHandler,!1),this.messageHandler=null)}renderWebpageInPopup(n,o,c){const s=document.createElement("div");s.classList.add("checkout-modal");const u=document.createElement("div");u.setAttribute("id","checkout-close-icon"),u.innerHTML="&times;",u.classList.add("close-icon"),u.addEventListener("click",()=>{this.closePopUp(),o?.()}),s.appendChild(u);const m=document.createElement("iframe");m.src=n,history.pushState({modalOpen:!0},""),m.classList.add("iframe"),s.appendChild(m),document.body.appendChild(s),s.style.opacity="0",m.addEventListener("load",()=>{s.style.opacity="1",c?.()})}closePopUp(){const n=document.querySelector(".backdrop"),o=document.querySelector(".checkout-modal");n&&document.body.removeChild(n),o&&document.body.removeChild(o),history.replaceState(null,""),window.removeEventListener("popstate",this.closePopUp)}injectStyles(){if(this.stylesInjected)return;const n=document.createElement("style");n.type="text/css",n.setAttribute("data-hubtel-checkout","true"),n.innerHTML=`
        .backdrop {
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999998;
        }

        .loader {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 999999;
            /* Your loader styles */
        }

        .checkout-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            height: 90%;
            padding-top: 20px;
            max-width: 480px;
            background-color: #fff;
            border-radius: 10px;
            z-index: 1000000;
            transition: opacity 0.5s ease, transform 0.5s ease;
            opacity: 0;
        }

        .close-icon {
            position: absolute;
            top: 10px;
            width: 25px;
            height: 25px;
            font-size: 20px;
            right: 10px;
            cursor: pointer;
            color: #fff;
            background-color: #000;
            text-align: center;
            border-radius: 50%;
        }

        .iframe {
            width: 100%;
            height: calc(100% - 20px);
            border: none;
        }

        .checkout-loader {
          width: 30px;
          height: 30px;
          border: 3px solid #FFF;
          border-bottom-color: #42b883;
          border-radius: 50%;
          display: inline-block;
          box-sizing: border-box;
          position : fixed;
          top : 50%;
          left : 50%;
          transform : translate(-50%, -50%);
          z-index : 999999;
          animation: rotation 1s linear infinite;
      }

      @keyframes rotation {
          0% {
              transform: rotate(0deg);
          }
          100% {
              transform: rotate(360deg);
          }
      }

      @media screen and (max-width: 600px) {
          .checkout-modal {
              width: 100%;
              height: 100%;
              border-radius: 0;
              padding-bottom: 0px;
              padding-top: 0px;
          }
          .close-icon{
            top: 10px;
            right: 15px;
          }

          .iframe {

            height: 100%;

        }
      }
    `,document.head.appendChild(n),this.stylesInjected=!0}}const q=new Map;function z(t,n){const o=q.get(n);if(o)return o;const c=new Promise((s,u)=>{if(document.getElementById(n)){s();return}const m=document.createElement("script");m.id=n,m.src=t,m.async=!0,m.onload=()=>s(),m.onerror=()=>u(new Error(`Failed to load ${n} script`)),document.head.appendChild(m)});return q.set(n,c),c}function W(){return z("https://js.paystack.co/v1/inline.js","paystack-script")}function Ae(){return Promise.resolve()}function J(){return z("https://checkout.flutterwave.com/v3.js","flutterwave-script")}function Q(){return z("https://js.stripe.com/v3/","stripe-script")}function X(){return z("https://sdk.monnify.com/plugin/monnify.js","monnify-script")}async function Z(t){if(await W(),!window.PaystackPop)throw new Error("Paystack script not loaded");window.PaystackPop.setup({key:t.key,email:t.email,amount:t.amount,currency:t.currency,ref:t.ref,metadata:t.metadata,callback:t.onSuccess,onClose:t.onClose}).openIframe()}async function ee(t){const n=new je,o=t.preferredMethod==="mobile_money"?"momo":t.preferredMethod==="card"?"card":void 0,c={amount:t.amount,purchaseDescription:t.purchaseDescription,customerPhoneNumber:t.customerPhone||"",clientReference:`hubtel_${Date.now()}`,...o?{paymentMethod:o}:{}},s=t.hubtelSessionToken||t.basicAuth||"",u={branding:"enabled",callbackUrl:t.callbackUrl||(typeof window<"u"?window.location.href:""),merchantAccount:typeof t.clientId=="string"?parseInt(t.clientId,10):t.clientId,basicAuth:s,...o?{paymentMethod:o}:{}};n.openModal({purchaseInfo:c,config:u,callBacks:{onPaymentSuccess:m=>{t.onSuccess(m),n.closePopUp()},onPaymentFailure:()=>{t.onClose()},onClose:()=>{t.onClose()}}})}async function te(t){if(await J(),!window.FlutterwaveCheckout)throw new Error("Flutterwave script not loaded");window.FlutterwaveCheckout({public_key:t.public_key,tx_ref:t.tx_ref,amount:t.amount,currency:t.currency,customer:t.customer,payment_options:t.payment_options,customizations:t.customizations,callback:t.callback,onclose:t.onclose})}async function oe(t){if(await Q(),!window.Stripe)throw new Error("Stripe.js not loaded");return window.Stripe(t)}async function He(t){const o=await(await oe(t.publishableKey)).confirmPayment({elements:t.elements,clientSecret:t.clientSecret,redirect:"if_required"});o.error?t.onError({message:o.error.message||"Payment failed"}):o.paymentIntent&&t.onSuccess({paymentIntentId:o.paymentIntent.id,status:o.paymentIntent.status})}async function ne(t){if(await X(),!window.MonnifySDK)throw new Error("Monnify SDK not loaded");window.MonnifySDK.initialize({amount:t.amount,currency:t.currency,reference:t.reference,customerName:t.customerName,customerEmail:t.customerEmail,customerMobileNumber:t.customerPhone,apiKey:t.apiKey,contractCode:t.contractCode,paymentDescription:t.paymentDescription||"Payment",isTestMode:t.isTestMode??!1,metadata:t.metadata,onComplete:n=>{n.status==="SUCCESS"?t.onSuccess({transactionReference:n.transactionReference,paymentReference:n.paymentReference,...n}):t.onError?.({message:n.message||"Payment failed"})},onClose:t.onClose})}async function re(t,n){t.onInitiated();try{const o=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone_number:t.phoneNumber,amount:t.amount,reference:t.reference,description:t.description})});if(!o.ok){const u=(await o.json().catch(()=>({}))).message||"Failed to initiate M-Pesa payment";return t.onError({message:u}),{status:"failed",message:u}}const c=await o.json();return{status:"initiated",message:"Please check your phone and enter your M-Pesa PIN to complete the payment.",transactionId:c.checkout_request_id||c.transaction_id}}catch(o){const c=o instanceof Error?o.message:"Network error";return t.onError({message:c}),{status:"failed",message:c}}}const Ke=["disabled"],qe={key:0,class:"reevit-spinner"},Ye={class:"reevit-modal-header"},Ge=["src"],We={class:"reevit-modal-body"},Je={key:0,class:"reevit-loading-state"},Qe={key:1,class:"reevit-error-state"},Xe={key:2,class:"reevit-success-state"},Ze={key:3,class:"reevit-method-step reevit-animate-slide-up"},et={key:0,class:"reevit-inline-action reevit-animate-fade-in"},tt=["disabled"],ot={key:1,class:"reevit-inline-action reevit-animate-fade-in"},nt={class:"reevit-inline-action__hint"},rt=["disabled"],at={key:0,class:"reevit-method-step__actions reevit-animate-slide-up"},st={key:0},it={key:1,class:"reevit-card-info reevit-animate-fade-in"},lt={class:"reevit-info-text"},ct=["disabled"],dt={key:0,class:"reevit-spinner"},ut={key:1},mt=e.defineComponent({__name:"ReevitCheckout",props:{publicKey:{},amount:{},currency:{},email:{},phone:{},reference:{},metadata:{},paymentMethods:{},theme:{},isOpen:{type:Boolean},apiBaseUrl:{},initialPaymentIntent:{}},emits:["success","error","close"],setup(t,{emit:n}){const o=t,c=n,{status:s,paymentIntent:u,selectedMethod:m,error:a,isLoading:p,isReady:r,initialize:l,selectMethod:y,handlePspSuccess:N,handlePspError:$,close:j,reset:L}=Y({config:{publicKey:o.publicKey,amount:o.amount,currency:o.currency,email:o.email,phone:o.phone,reference:o.reference,metadata:o.metadata,paymentMethods:o.paymentMethods,initialPaymentIntent:o.initialPaymentIntent},apiBaseUrl:o.apiBaseUrl,onSuccess:d=>c("success",d),onError:d=>c("error",d),onClose:()=>c("close")}),I=e.ref(o.isOpen??!1),P=e.ref(null),T={hubtel:"Hubtel",paystack:"Paystack",flutterwave:"Flutterwave",monnify:"Monnify",mpesa:"M-Pesa",stripe:"Stripe"};e.watch(()=>o.isOpen,d=>{d!==void 0&&(I.value=d)});const D=()=>{I.value=!0,P.value=null,!u.value&&s.value==="idle"&&l()};e.watch([I,u,m],([d,i,h])=>{if(d&&i&&h){const _=(P.value||i.recommendedPsp||"paystack").toLowerCase().includes("mpesa");(h==="card"||h==="mobile_money"&&(!_||o.phone))&&b(null)}});const O=()=>{I.value=!1,j(),P.value=null},B=e.computed(()=>o.paymentMethods?.length?o.paymentMethods:["card","mobile_money"]),V=e.computed(()=>{const d=u.value;if(!d)return[];const i=new Set(B.value),h=(d.availableProviders||[]).map(_=>{const se=_.provider.toLowerCase().includes("hubtel")?_.methods.filter(U=>U==="card"||U==="mobile_money"):_.methods;return{..._,methods:se.filter(U=>i.has(U))}}).filter(_=>_.methods.length>0);if(h.length>0)return h;const E=d.recommendedPsp.toLowerCase().includes("hubtel")?B.value.filter(_=>_==="card"||_==="mobile_money"):B.value;return[{provider:d.recommendedPsp,name:T[d.recommendedPsp]||d.recommendedPsp,methods:E}]}),w=e.computed(()=>{const d=u.value;return P.value||d?.recommendedPsp||"paystack"}),F=e.computed(()=>{const d=V.value.find(i=>i.provider===w.value);return d?.methods.length?d.methods:B.value});e.watch(()=>V.value,d=>{d.length&&(P.value&&d.some(i=>i.provider===P.value)||(d.length===1?P.value=d[0].provider:P.value=null))},{immediate:!0}),e.watch([F,m],([d,i])=>{!i||d.length===0||d.includes(i)||y(d[0])});const A=d=>{if(d===P.value){P.value=null,L();return}const i=V.value.find(_=>_.provider===d),h=i?.methods.length?i.methods:B.value,E=m.value&&h.includes(m.value)?m.value:h[0];P.value=d,L(),l(E,{preferredProvider:d,allowedProviders:[d]})},v=d=>{y(d)},b=async d=>{const i=u.value;if(!i)return;const h=w.value;try{if(h==="paystack")await Z({key:o.publicKey,email:o.email||"",amount:o.amount,currency:o.currency,ref:i.id,onSuccess:E=>N(E),onClose:()=>{}});else if(h==="hubtel")await ee({clientId:i.pspCredentials?.merchantAccount||o.publicKey,purchaseDescription:`Payment for ${o.amount} ${o.currency}`,amount:o.amount,customerPhone:d?.phone||o.phone,customerEmail:o.email,hubtelSessionToken:i.id,preferredMethod:M.value||void 0,onSuccess:E=>N(E),onClose:()=>{}});else if(h==="flutterwave")await te({public_key:o.publicKey,tx_ref:i.id,amount:o.amount,currency:o.currency,customer:{email:o.email||"",phone_number:d?.phone||o.phone},callback:E=>N(E),onclose:()=>{}});else if(h==="monnify")await ne({apiKey:i.pspPublicKey||o.publicKey,contractCode:o.metadata?.contract_code||o.publicKey,amount:o.amount,currency:o.currency,reference:i.reference||i.id,customerName:o.metadata?.customer_name||o.email||"",customerEmail:o.email||"",customerPhone:d?.phone||o.phone,metadata:o.metadata,onSuccess:E=>N(E),onClose:()=>{}});else if(h==="mpesa"){const E=`${o.apiBaseUrl||"https://api.reevit.io"}/v1/payments/${i.id}/mpesa`;await re({phoneNumber:d?.phone||o.phone||"",amount:o.amount,reference:i.reference||i.id,description:`Payment ${i.reference||""}`,onInitiated:()=>{},onSuccess:_=>N(_),onError:_=>$({code:"MPESA_ERROR",message:_.message})},E)}else $(h==="stripe"?{code:"STRIPE_NOT_IMPLEMENTED",message:"Stripe integration requires custom Elements setup. Please use the React SDK or implement custom Stripe Elements."}:{code:"UNSUPPORTED_PSP",message:`Payment provider "${h}" is not supported in this checkout.`})}catch(E){$({code:"BRIDGE_ERROR",message:E instanceof Error?E.message:"Failed to open payment gateway"})}},k=e.computed(()=>({...u.value?.branding||{},...o.theme||{}})),C=e.computed(()=>f.createThemeVariables(k.value)),S=e.computed(()=>k.value?.darkMode);e.watch(I,d=>{d?document.body.style.overflow="hidden":document.body.style.overflow=""}),e.onUnmounted(()=>{document.body.style.overflow=""});const g=e.computed(()=>s.value),x=e.computed(()=>a.value),M=e.computed(()=>m.value),R=e.computed(()=>p.value),ae=e.computed(()=>r.value);return(d,i)=>(e.openBlock(),e.createElementBlock("div",{class:"reevit-sdk-container",style:e.normalizeStyle(C.value)},[e.renderSlot(d.$slots,"default",{open:D,isLoading:R.value},()=>[e.createElementVNode("button",{type:"button",class:"reevit-pay-button",onClick:D,disabled:R.value},[R.value?(e.openBlock(),e.createElementBlock("span",qe)):e.renderSlot(d.$slots,"button-text",{key:1},()=>[i[5]||(i[5]=e.createTextVNode("Pay Now",-1))])],8,Ke)]),(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[I.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:"reevit-modal-overlay",onClick:e.withModifiers(O,["self"])},[e.createElementVNode("div",{class:e.normalizeClass(["reevit-modal-content",{"reevit-modal--dark":S.value}]),style:e.normalizeStyle(C.value)},[e.createElementVNode("button",{class:"reevit-modal-close",onClick:O,"aria-label":"Close"}," Ã— "),e.createElementVNode("div",Ye,[e.createElementVNode("img",{src:k.value.logoUrl||"https://i.imgur.com/bzUR5Lm.png",alt:"Checkout",class:"reevit-modal__logo"},null,8,Ge)]),e.createElementVNode("div",We,[g.value==="loading"?(e.openBlock(),e.createElementBlock("div",Je,[...i[6]||(i[6]=[e.createElementVNode("div",{class:"reevit-spinner reevit-spinner--large"},null,-1),e.createElementVNode("p",null,"Initializing payment...",-1)])])):g.value==="failed"&&x.value?(e.openBlock(),e.createElementBlock("div",Qe,[i[7]||(i[7]=e.createElementVNode("div",{class:"reevit-error-icon"},"âš ï¸",-1)),i[8]||(i[8]=e.createElementVNode("h3",null,"Payment Failed",-1)),e.createElementVNode("p",null,e.toDisplayString(x.value.message),1),e.createElementVNode("button",{class:"reevit-retry-btn",onClick:i[0]||(i[0]=h=>e.unref(l)())},"Retry")])):g.value==="success"?(e.openBlock(),e.createElementBlock("div",Xe,[i[9]||(i[9]=e.createElementVNode("div",{class:"reevit-success-icon"},"âœ…",-1)),i[10]||(i[10]=e.createElementVNode("h3",null,"Payment Successful",-1)),i[11]||(i[11]=e.createElementVNode("p",null,"Thank you for your payment.",-1)),e.createElementVNode("button",{class:"reevit-done-btn",onClick:O},"Done")])):ae.value?(e.openBlock(),e.createElementBlock("div",Ze,[V.value.length>1?(e.openBlock(),e.createBlock(G,{key:0,providers:V.value,"selected-provider":P.value,disabled:R.value,theme:k.value,"selected-method":M.value,onSelect:A,onMethodSelect:v},{"method-content":e.withCtx(()=>[M.value==="card"?(e.openBlock(),e.createElementBlock("div",et,[i[12]||(i[12]=e.createElementVNode("p",{class:"reevit-inline-action__hint"}," You'll be redirected to complete your card payment securely. ",-1)),e.createElementVNode("button",{class:"reevit-btn reevit-btn--primary",onClick:i[1]||(i[1]=h=>b(null)),disabled:g.value==="processing"}," Pay with Card ",8,tt)])):M.value==="mobile_money"?(e.openBlock(),e.createElementBlock("div",ot,[w.value.includes("mpesa")&&!o.phone?(e.openBlock(),e.createBlock(H,{key:0,"initial-phone":o.phone,loading:g.value==="processing","hide-cancel":"",onSubmit:b},null,8,["initial-phone","loading"])):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createElementVNode("p",nt,e.toDisplayString(w.value.includes("hubtel")?"Opens the Hubtel checkout with Mobile Money selected.":`Continue to pay securely with Mobile Money via ${T[w.value]||w.value}.`),1),e.createElementVNode("button",{class:"reevit-btn reevit-btn--primary",onClick:i[2]||(i[2]=h=>b(null)),disabled:g.value==="processing"},e.toDisplayString(w.value.includes("hubtel")?"Continue with Hubtel":"Pay with Mobile Money"),9,rt)],64))])):e.createCommentVNode("",!0)]),_:1},8,["providers","selected-provider","disabled","theme","selected-method"])):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createVNode(K,{methods:F.value,selected:M.value,provider:w.value,"show-label":!1,layout:"grid",onSelect:v},null,8,["methods","selected","provider"]),M.value?(e.openBlock(),e.createElementBlock("div",at,[M.value==="mobile_money"&&w.value.includes("mpesa")&&!o.phone?(e.openBlock(),e.createElementBlock("div",st,[e.createVNode(H,{"initial-phone":o.phone,loading:g.value==="processing",onSubmit:b,onCancel:i[3]||(i[3]=h=>e.unref(y)(null))},null,8,["initial-phone","loading"])])):(e.openBlock(),e.createElementBlock("div",it,[e.createElementVNode("p",lt,e.toDisplayString(M.value==="card"?"You will be redirected to complete your card payment securely.":w.value.includes("hubtel")?"Opens the Hubtel checkout with Mobile Money selected.":`Continue to pay securely via ${T[w.value]||w.value}.`),1),e.createElementVNode("button",{class:"reevit-submit-btn",onClick:i[4]||(i[4]=h=>b(null)),disabled:g.value==="processing"},[g.value==="processing"?(e.openBlock(),e.createElementBlock("span",dt)):(e.openBlock(),e.createElementBlock("span",ut,e.toDisplayString(M.value==="card"?"Pay with Card":w.value.includes("hubtel")?"Continue with Hubtel":"Pay with Mobile Money"),1))],8,ct)]))])):e.createCommentVNode("",!0)],64))])):e.createCommentVNode("",!0)]),i[13]||(i[13]=e.createElementVNode("div",{class:"reevit-modal-footer"},[e.createElementVNode("div",{class:"reevit-trust-badges"},[e.createElementVNode("span",null,"PCI DSS Compliant"),e.createElementVNode("span",null,"â€¢"),e.createElementVNode("span",null,"SSL Secure")])],-1))],6)])):e.createCommentVNode("",!0)]))],4))}});Object.defineProperty(exports,"ReevitAPIClient",{enumerable:!0,get:()=>f.ReevitAPIClient});Object.defineProperty(exports,"cn",{enumerable:!0,get:()=>f.cn});Object.defineProperty(exports,"createReevitClient",{enumerable:!0,get:()=>f.createReevitClient});Object.defineProperty(exports,"detectCountryFromCurrency",{enumerable:!0,get:()=>f.detectCountryFromCurrency});Object.defineProperty(exports,"detectNetwork",{enumerable:!0,get:()=>f.detectNetwork});Object.defineProperty(exports,"formatAmount",{enumerable:!0,get:()=>f.formatAmount});Object.defineProperty(exports,"formatPhone",{enumerable:!0,get:()=>f.formatPhone});Object.defineProperty(exports,"validatePhone",{enumerable:!0,get:()=>f.validatePhone});exports.MobileMoneyForm=H;exports.PaymentMethodSelector=K;exports.ProviderSelector=G;exports.ReevitCheckout=mt;exports.confirmStripePayment=He;exports.createStripeInstance=oe;exports.initiateMPesaSTKPush=re;exports.loadFlutterwaveScript=J;exports.loadHubtelScript=Ae;exports.loadMonnifyScript=X;exports.loadPaystackScript=W;exports.loadStripeScript=Q;exports.openFlutterwaveModal=te;exports.openHubtelPopup=ee;exports.openMonnifyModal=ne;exports.openPaystackPopup=Z;exports.useReevit=Y;
